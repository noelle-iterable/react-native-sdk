  name: "GitHub Advanced Security - CodeQL"

  on:
    push:
      branches: [ "master" ]
    pull_request:
      branches: [ "master" ]
#    schedule:
      # Run CodeQL analysis every day at 2 AM UTC
#      - cron: '0 2 * * *'

  # Enable GitHub Advanced Security features
  permissions:
    actions: read
    contents: read
    security-events: write
    pull-requests: write

  jobs:
    analyze:
      name: CodeQL Analysis for Java
      runs-on: 'ubuntu-latest'
      continue-on-error: true
      # runs-on: ubuntu-latest
      permissions:
        actions: read
        contents: read
        security-events: write
        pull-requests: write

      strategy:
        fail-fast: false
    #    matrix:
    #      # Define the matrix of languages to analyze
    #      language: ['java', 'cpp', 'swift', 'javascript']

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4
          with:
            # Fetch full history for better analysis
            fetch-depth: 0

        - name: Initialize CodeQL
          uses: github/codeql-action/init@v3
          with:
            languages: 'java'

        - name: Validate Gradle Wrapper
          uses: gradle/action/wrapper-validation@v4

        - name: Setup Java (Java/Kotlin)
          uses: actions/setup-java@v4
          with:
            distribution: 'temurin'
            java-version: '11'

        - name: Build with Gradle
          run: ./gradlew build

        - name: Perform CodeQL Analysis
          uses: github/codeql-action/analyze@v3
